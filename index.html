<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MaldoFit PRO</title>
    <script src="data.js"></script> 
    <style>
        :root {
            --bg: #000000; --card: #111111; --text: #ffffff; --sub: #888888;
            --border: #222222; --accent: #00f2ff; /* Azul Neon */
            --ok: #00ff66; --bad: #ff0055;
        }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, system-ui, sans-serif; margin: 0; padding: 0 0 90px 0; -webkit-tap-highlight-color: transparent; }
        
        /* HEADER */
        .header { position: sticky; top: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        h1 { margin: 0; font-size: 22px; font-weight: 900; letter-spacing: -1px; background: linear-gradient(45deg, var(--accent), #bc13fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn-ghost { background: none; border: 1px solid var(--accent); color: var(--accent); padding: 5px 12px; border-radius: 15px; font-size: 11px; font-weight: 700; cursor: pointer; }

        /* TABS DIAS */
        .days-wrap { overflow-x: auto; padding: 15px 20px; display: flex; gap: 10px; scrollbar-width: none; }
        .day-pill { background: var(--card); border: 1px solid var(--border); padding: 8px 16px; border-radius: 20px; color: var(--sub); font-size: 13px; font-weight: 600; white-space: nowrap; cursor: pointer; transition: 0.2s; }
        .day-pill.active { background: var(--accent); color: #000; border-color: var(--accent); box-shadow: 0 0 15px rgba(0, 242, 255, 0.3); }

        /* DASHBOARD MACROS */
        .dash { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 0 20px 20px; }
        .stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 10px 5px; text-align: center; }
        .stat-val { font-size: 14px; font-weight: 800; display: block; }
        .stat-lbl { font-size: 10px; color: var(--sub); text-transform: uppercase; margin-top: 3px; }
        .bar-bg { height: 3px; background: #333; margin-top: 5px; border-radius: 2px; overflow: hidden; }
        .bar-fill { height: 100%; width: 0%; transition: 0.3s; }

        /* LISTA COMIDAS */
        .list { padding: 0 20px; }
        .item { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 15px; margin-bottom: 10px; position: relative; }
        .i-cat { font-size: 10px; font-weight: 800; color: var(--accent); text-transform: uppercase; margin-bottom: 5px; }
        .i-name { font-size: 15px; font-weight: 600; margin-bottom: 5px; line-height: 1.3; padding-right: 30px; }
        .i-meta { font-size: 11px; color: var(--sub); font-family: monospace; }
        .i-ing { font-size: 12px; color: #666; margin-top: 8px; padding-top: 8px; border-top: 1px solid #222; line-height: 1.4; }
        .btn-act { position: absolute; top: 12px; right: 12px; width: 28px; height: 28px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .add { background: var(--ok); color: #000; font-weight: bold; font-size: 18px; }
        .del { background: transparent; color: var(--bad); font-size: 22px; top: 10px; right: 10px; }

        /* BUSCADOR */
        .search-area { position: sticky; top: 63px; background: var(--bg); z-index: 90; padding: 10px 20px; border-bottom: 1px solid #111; }
        .search-inp { width: 100%; background: #1a1a1a; border: 1px solid var(--border); color: #fff; padding: 12px; border-radius: 10px; font-size: 15px; outline: none; }
        .cats { display: flex; gap: 8px; overflow-x: auto; margin-top: 10px; padding-bottom: 5px; scrollbar-width: none; }
        .tag { padding: 6px 12px; background: #222; border-radius: 15px; font-size: 11px; color: #aaa; white-space: nowrap; border: 1px solid transparent; cursor: pointer; }
        .tag.active { background: var(--accent); color: #000; }

        /* MODAL */
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .m-content { background: var(--card); width: 90%; max-width: 400px; padding: 25px; border-radius: 20px; border: 1px solid var(--border); max-height: 85vh; overflow-y: auto; }
        .inp-grp { margin-bottom: 15px; }
        .inp-lbl { display: block; color: var(--sub); font-size: 11px; margin-bottom: 5px; text-transform: uppercase; font-weight: 700; }
        .inp { width: 100%; background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; border-radius: 8px; font-size: 15px; }
        .btn-save { width: 100%; background: var(--accent); color: #000; padding: 12px; border-radius: 10px; border: none; font-weight: 800; text-transform: uppercase; margin-top: 10px; cursor: pointer; }

        /* GRID DIAS */
        .grid-days { display: grid; gap: 8px; margin-top: 20px; }
        .g-row { display: grid; grid-template-columns: 40px 1fr 1fr 1fr 1fr; gap: 5px; align-items: center; }
        .g-inp { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 6px; text-align: center; border-radius: 4px; font-size: 12px; }

        /* NAV */
        .nav { position: fixed; bottom: 0; width: 100%; background: rgba(10,10,10,0.95); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 10px 0 25px; z-index: 1000; backdrop-filter: blur(10px); }
        .n-btn { background: 0 0; border: none; color: #555; display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; font-weight: 600; cursor: pointer; }
        .n-btn.active { color: var(--accent); } .icon { font-size: 20px; }

        .view { display: none; } .view.active { display: block; }
        @media print { .nav, .header, .days-wrap, .add, .del, .search-area, .btn-ghost { display: none!important; } .view { display: block!important; } body { background: #fff; color: #000; } .item { border: 1px solid #ccc; background: #fff; color: #000; break-inside: avoid; } }
    </style>
</head>
<body>

<div id="v-home" class="view active">
    <div class="header"><h1>MaldoFit</h1><button class="btn-ghost" onclick="toggleModal(true)">OBJETIVOS</button></div>
    <div class="days-wrap" id="day-tabs"></div>
    <div class="dash">
        <div class="stat"><span class="val" id="dk">0</span><span class="lbl">Kcal</span><div class="bar-bg"><div id="bk" class="fill" style="background:#fff"></div></div></div>
        <div class="stat"><span class="val" id="dp">0</span><span class="lbl">Prot</span><div class="bar-bg"><div id="bp" class="fill" style="background:#ff2a6d"></div></div></div>
        <div class="stat"><span class="val" id="dc">0</span><span class="lbl">Carb</span><div class="bar-bg"><div id="bc" class="fill" style="background:#ffd500"></div></div></div>
        <div class="stat"><span class="val" id="df">0</span><span class="lbl">Grasa</span><div class="bar-bg"><div id="bf" class="fill" style="background:#0aff60"></div></div></div>
    </div>
    <div id="plan-list" class="list"></div>
</div>

<div id="v-lib" class="view">
    <div class="header"><h1>Alimentos</h1></div>
    <div class="search-area">
        <input type="text" id="search" class="search-inp" placeholder="Buscar..." onkeyup="renderLib()">
        <div class="cats">
            <div class="tag active" onclick="setCat('Desayuno',this)">Desayuno</div>
            <div class="tag" onclick="setCat('Tentempi√©',this)">Media Ma√±ana</div>
            <div class="tag" onclick="setCat('Comida',this)">Comida</div>
            <div class="tag" onclick="setCat('Merienda',this)">Merienda</div>
            <div class="tag" onclick="setCat('Cena',this)">Cena</div>
        </div>
    </div>
    <div id="lib-list" class="list" style="padding-bottom:100px"></div>
</div>

<div id="modal">
    <div class="m-box">
        <h2 style="color:var(--accent);margin-top:0">Configuraci√≥n</h2>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
            <div class="inp-grp"><label class="inp-lbl">Peso</label><input type="number" id="w" class="inp" value="80"></div>
            <div class="inp-grp"><label class="inp-lbl">Altura</label><input type="number" id="h" class="inp" value="180"></div>
        </div>
        <div class="inp-grp"><label class="inp-lbl">Edad</label><input type="number" id="a" class="inp" value="30"></div>
        <div class="inp-grp"><label class="inp-lbl">Sexo</label><select id="s" class="inp"><option value="m">Hombre</option><option value="f">Mujer</option></select></div>
        <div class="inp-grp"><label class="inp-lbl">Actividad</label><select id="act" class="inp"><option value="1.2">Sedentario</option><option value="1.55" selected>CrossFit (3-5d)</option><option value="1.725">Alto</option></select></div>
        <div class="inp-grp"><label class="inp-lbl">Objetivo</label><select id="goal" class="inp"><option value="-0.2">Definici√≥n (-20%)</option><option value="0">Mantenimiento</option><option value="0.1">Volumen (+10%)</option></select></div>
        <button class="btn-save" onclick="calc()">Auto-Calcular</button>
        <hr style="border:0;border-top:1px solid #333;margin:20px 0">
        <label class="inp-lbl" style="color:#fff">Ajuste Manual por D√≠a</label>
        <div id="grid-days" class="grid-days"></div>
        <button class="btn-save" onclick="saveTargets()" style="background:#333;margin-top:20px">Guardar Cambios</button>
        <button onclick="toggleModal(false)" style="width:100%;padding:15px;background:0 0;border:none;color:#666;margin-top:5px">Cerrar</button>
    </div>
</div>

<div class="nav">
    <button class="n-btn active" onclick="go('v-home',this)"><span class="icon">üìÖ</span>Plan</button>
    <button class="n-btn" onclick="go('v-lib',this)"><span class="icon">üçî</span>Alimentos</button>
    <button class="n-btn" onclick="window.print()"><span class="icon">üñ®Ô∏è</span>PDF</button>
</div>

<script>
// --- ESTADO ---
let state = { day:'Lunes', cat:'Desayuno', plan:{}, targets:{} };
const DAYS = ["Lunes","Martes","Mi√©rcoles","Jueves","Viernes","S√°bado","Domingo"];

// --- INIT ---
window.onload = function() {
    if(typeof foodDB === 'undefined') {
        alert("‚ö†Ô∏è ERROR: No se ha encontrado la base de datos. Aseg√∫rate de tener el archivo 'data.js' en la misma carpeta.");
        return;
    }
    DAYS.forEach(d=>{ if(!state.plan[d]) state.plan[d]=[] });
    try {
        const t=localStorage.getItem('mf_targets_v4');
        const p=localStorage.getItem('mf_plan_v4');
        if(t) state.targets=JSON.parse(t); else calc();
        if(p) state.plan=JSON.parse(p);
    } catch(e){ calc(); }
    renderTabs(); renderPlan(); renderLib();
}

// --- LOGICA ---
function calc() {
    const w=parseFloat(document.getElementById('w').value)||80, h=parseFloat(document.getElementById('h').value)||180, a=parseFloat(document.getElementById('a').value)||30, act=parseFloat(document.getElementById('act').value)||1.55, goal=parseFloat(document.getElementById('goal').value)||0;
    const s=document.getElementById('s').value;
    let bmr = (s==='m') ? 88.362+(13.397*w)+(4.799*h)-(5.677*a) : 447.593+(9.247*w)+(3.098*h)-(4.330*a);
    const k=Math.round(bmr*act*(1+goal)), p=Math.round(w*2), f=Math.round(w*0.9), c=Math.round((k-p*4-f*9)/4);
    DAYS.forEach(d=>state.targets[d]={k,p,c,f});
    saveT(); renderGrid();
}

function renderGrid() {
    const g=document.getElementById('grid-days'); g.innerHTML='';
    g.innerHTML += `<div class="g-row"><span style="font-size:10px">D√çA</span><span style="font-size:10px;text-align:center">KC</span><span style="font-size:10px;text-align:center;color:var(--bad)">P</span><span style="font-size:10px;text-align:center;color:var(--warn)">C</span><span style="font-size:10px;text-align:center;color:var(--ok)">G</span></div>`;
    DAYS.forEach(d=>{
        const t=state.targets[d]||{k:2500,p:160,c:300,f:70};
        g.innerHTML+=`<div class="g-row"><span style="font-size:11px;font-weight:700">${d.substr(0,3)}</span><input type="number" id="k_${d}" value="${t.k}" class="g-inp"><input type="number" id="p_${d}" value="${t.p}" class="g-inp" style="color:var(--bad)"><input type="number" id="c_${d}" value="${t.c}" class="g-inp" style="color:var(--warn)"><input type="number" id="f_${d}" value="${t.f}" class="g-inp" style="color:var(--ok)"></div>`;
    });
}

function saveTargets() {
    DAYS.forEach(d=>{
        state.targets[d]={k:parseInt(document.getElementById(`k_${d}`).value),p:parseInt(document.getElementById(`p_${d}`).value),c:parseInt(document.getElementById(`c_${d}`).value),f:parseInt(document.getElementById(`f_${d}`).value)};
    });
    saveT(); toggleModal(false); renderPlan();
}

function saveT(){ localStorage.setItem('mf_targets_v4',JSON.stringify(state.targets)); }
function saveP(){ localStorage.setItem('mf_plan_v4',JSON.stringify(state.plan)); }

function renderTabs() {
    const c=document.getElementById('day-tabs'); c.innerHTML='';
    DAYS.forEach(d=>c.innerHTML+=`<div class="day-pill ${state.day===d?'active':''}" onclick="setDay('${d}',this)">${d}</div>`);
}

function setDay(d,el) { state.day=d; document.querySelectorAll('.day-pill').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderPlan(); }
function setCat(c,el) { state.cat=c; document.querySelectorAll('.tag').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderLib(); }
function go(v,btn) { document.querySelectorAll('.view').forEach(x=>x.classList.remove('active')); document.getElementById(v).classList.add('active'); document.querySelectorAll('.n-btn').forEach(x=>x.classList.remove('active')); btn.classList.add('active'); }
function toggleModal(s) { document.getElementById('modal').style.display=s?'flex':'none'; if(s) renderGrid(); }

function renderLib() {
    const l=document.getElementById('lib-list'), s=document.getElementById('search').value.toLowerCase();
    l.innerHTML='';
    const filtered = foodDB.filter(x => {
        let m = x.t === state.cat;
        if(state.cat==='Tentempi√©' && (x.t.includes('Ma√±ana')||x.t.includes('M.MA√ëANA'))) m=true;
        return m && (x.n.toLowerCase().includes(s) || x.d.toLowerCase().includes(s));
    });
    filtered.forEach(x=>{
        l.innerHTML+=`<div class="item"><div class="i-cat">${x.t}</div><div class="i-name">${x.n}</div><div class="i-meta">üî•${x.k} P${x.p} C${x.c} F${x.f}</div><div class="i-ing">${x.d}</div><button class="act add" onclick="add(${x.i})">+</button></div>`;
    });
}

function renderPlan() {
    const l=document.getElementById('plan-list'); l.innerHTML='';
    let tot={k:0,p:0,c:0,f:0};
    (state.plan[state.day]||[]).forEach((x,i)=>{
        tot.k+=x.k; tot.p+=x.p; tot.c+=x.c; tot.f+=x.f;
        l.innerHTML+=`<div class="item"><div class="i-cat">${x.t}</div><div class="i-name">${x.n}</div><div class="i-meta">üî•${x.k} P${x.p} C${x.c} F${x.f}</div><button class="act del" onclick="del(${i})">√ó</button></div>`;
    });
    const t=state.targets[state.day]||{k:2500,p:160,c:300,f:70};
    updB('k',tot.k,t.k); updB('p',tot.p,t.p); updB('c',tot.c,t.c); updB('f',tot.f,t.f);
}

function updB(k,v,m) { document.getElementById('d'+k).innerText=`${v}/${m}`; document.getElementById('b'+k).style.width=Math.min((v/m)*100,100)+'%'; }
function add(id) { state.plan[state.day].push(foodDB.find(x=>x.i===id)); saveP(); renderPlan(); }
function del(i) { state.plan[state.day].splice(i,1); saveP(); renderPlan(); }
</script>
</body>
</html>
